name: Analyse SonarQube

on:
  push:
    branches: [master]
  pull_request:
    branches: [master]

jobs:
  sonarqube:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'

    - name: Install dependencies
      run: npm install

    - name: Run SonarQube Scan
      env:
        SONAR_TOKEN: ${{ secrets.sqa_ac30299637a8eddfac10d3d364c6113d35964bb4 }}
      run: |
        npm install -g sonar-scanner
        sonar-scanner \
          -Dsonar.projectKey=proloves \
          -Dsonar.sources=. \
          -Dsonar.host.url=http://91.160.67.228:40001 \
          -Dsonar.login=$SONAR_TOKEN
